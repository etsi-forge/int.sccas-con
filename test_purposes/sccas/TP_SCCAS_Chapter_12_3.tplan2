/*
Copyright (c) ETSI 2019-2022.

This software is subject to copyrights owned by ETSI. Non-exclusive permission
is hereby granted, free of charge, to copy, reproduce and amend this file
under the following conditions: It is provided "as is", without warranty of any
kind, expressed or implied.

ETSI shall never be liable for any claim, damages, or other liability arising
from its use or inability of use.This permission does not apply to any documentation
associated with this file for which ETSI keeps all rights reserved. The present
copyright notice shall be included in all copies of whole or part of this
file and shall not imply any sub-license right.
*/

/* interface ISC at SCCAS */
Package TP_SCCAS_Chapter_12_3 { 
	
	 Group "12.3.0 General"{
    	
    	import all from Sip_Common;	
    } // end Group "12.3.0 General"
    
    Group "12.3.1 SCC AS procedures for PS to CS access transfer, PS to CS SRVCC"{
    	
    	import all from Sip_Common;
    	Test Purpose {
        
        TP Id TP_ISC_SCCAS_SRA_INV_01
        
        Test objective  "Verify that the SCCAS distinguish SIP INVITE with STN-SR for nonexisting dialog"
        
        Reference 
            "ETSI TS 124 237 [1], Clause 12.3.1"
        
        Config Id CFG_SCCAS_01
        
        PICS Selection NONE //SCCAS_PS2CS_SRVCC 
                
        Initial conditions with {
            the UE entity isRegisteredTo the IMS_A and 
            the UE entity hasEstablishedDialog the SCCAS_UE_TERM
        }
        
        Expected behaviour
            ensure that {
            	when {
                    the IUT entity receives a INVITE containing
                        RequestUri indicating value PX_STI_URI,
                        From indicating value PX__SIP_URI,
                        To indicating value PX__SIP_URI,
                        CallId indicating value PX_STI_CALLID,
                        Via indicating value PX_STI_VIA,
                        Contact,
                        TargetDialog containing "dialog info from nonexisting PS session", 
                        Require indicating value "tdialog",
                        PAssertedIdentity indicating value PX_UE_CMSISDN
                        SipMessageBody;;
                    from the IMS_S_CSCF entity
                }
                then {
                	the IUT entity sends a r_480_TemporaryUnavailable
	                to the IMS_S_CSCF entity                
	             }    
            }
    	} // End of TP_ISC_SCCAS_SRA_INV_01	
    	
    	Test Purpose {
        
        TP Id TP_ISC_SCCAS_SRA_INI_02
        
        Test objective  "Verify that the SCCAS distinguish SIP INVITE with STN-SR and informs remote UE"
        
        Reference 
            "ETSI TS 124 237 [1], Clause 12.3.1"
        
        Config Id CFG_SCCAS_01
        
        PICS Selection NONE //SCCAS_PS2CS_SRVCC 
                
        Initial conditions with {
            the UE entity isRegisteredTo the IMS_A and 
            the UE entity hasEstablishedDialog the SCCAS_UE_TERM
        }
        
        Expected behaviour
            ensure that {
            	when {
                    the IUT entity receives a INVITE containing
                        RequestUri indicating value PX_STNSR_URI,
                        From indicating value PX__SIP_URI,
                        To indicating value PX__SIP_URI,
                        CallId indicating value PX_STI_CALLID,
                        Via indicating value PX_STNSR_VIA,
                        Contact,
                        TargetDialog containing "dialog info from PS session", 
                        Require indicating value "tdialog",
                        PAssertedIdentity indicating value PX_UE_CMSISDN
                        SipMessageBody;;
                    from the IMS_S_CSCF entity
                }
                then {
                	the IUT entity sends a ReINVITE //for remote UE leg
	                to the IMS_S_CSCF entity and 
	               
                    the IUT entity receives a r_200_Ok and
                    
                    the IUT entity sends a r_200_Ok 
	             }    
            }
    	} // End of TP_ISC_SCCAS_SRA_INV_02
    } // end Group "12.3.1 SCC AS procedures for PS to CS access transfer, PS to CS SRVCC"
    
    Group "12.3.2 SCC AS procedures for PS to CS access transfer with MSC server assisted mid-call feature, PS to CS SRVCC"{
    	
    	import all from Sip_Common;
    	Test Purpose {
        
        TP Id TP_ISC_SCCAS_SRA_INV_03
        
        Test objective  "Verify that the SCCAS distinguish Transfer of first session"
        
        Reference 
            "ETSI TS 124 237 [1], Clauses 12.3.2.1,12.3.2.2"
        
        Config Id CFG_SCCAS_01
        
        PICS Selection NONE //SCCAS_PS2CS_SRVCC 
                
        Initial conditions with {
            the UE entity isRegisteredTo the IMS_A and 
            the UE entity hasEstablishedDialog the SCCAS_UE_TERM
        }
        
        Expected behaviour
            ensure that {
            	when {
                    the IUT entity receives a INVITE containing
                        RequestUri indicating value PX_STI_URI,
                        From indicating value PX__SIP_URI,
                        To indicating value PX__SIP_URI,
                        CallId indicating value PX_STI_CALLID,
                        Via indicating value PX_STI_VIA,
                        Contact containing 
                            g3gppMidcallMediaFeature Tag
                        TargetDialog containing "dialog info existing PS session", 
                        Require indicating value "tdialog",
                        PAssertedIdentity indicating value PX_UE_CMSISDN
                        SipMessageBody;;;
                    from the IMS_S_CSCF entity and
                    the IUT entity receives a  r_200_Ok
                }
                then {
                	the IUT entity sends a r_200_Ok
	                to the IMS_S_CSCF entity                
	             }    
            }
    	} // End of TP_ISC_SCCAS_SRA_INV_03	
    		
    } // end Group "12.3.2 SCC AS procedures for PS to CS access transfer with MSC server assisted mid-call feature, PS to CS SRVCC"
    
    Group "12.3.3 SCC AS procedures for PS to CS SRVCC, abnormal case"{
    	
    	//import all from Sip_Common;	
    	Group "12.3.3.1 PS to CS SRVCC cancelled by MME/SGSN or failure by UE to transition to CS domain for ongoing session"{
    		
    		import all from Sip_Common;	
    		Test Purpose {
        
	        TP Id TP_ISC_SCCAS_SRA_INI_04
	        
	        Test objective  "Verify that the SCCAS distinguish SIP INVITE with STN-SR and not release source leg"
	        
	        Reference 
	            "ETSI TS 124 237 [1], Clause 12.3.1"
	        
	        Config Id CFG_SCCAS_01
	        
	        PICS Selection NONE //SCCAS_PS2CS_SRVCC 
	                
	        Initial conditions with {
	            the UE entity isRegisteredTo the IMS_A and 
	            the UE entity hasEstablishedDialog the SCCAS_UE_TERM
	        }
	        
	        Expected behaviour
	            ensure that {
	            	when {
	                    the IUT entity receives a ReINVITE containing
	                        RequestUri indicating value PX_STNSR_URI,
	                        From indicating value PX__SIP_URI,
	                        To indicating value PX__SIP_URI,
	                        CallId indicating value PX_STI_CALLID,
	                        Via indicating value PX_STNSR_VIA,
	                        Contact,
	                        TargetDialog containing "dialog info from PS session", 
	                        Require indicating value "tdialog",
	                        PAssertedIdentity indicating value PX_UE_CMSISDN
	                        SipMessageBody,
	                        Reason containing Cause indicating value "487";
	                        ;;
	                    from the IMS_S_CSCF entity
	                }
	                then {
	                	the IUT entity not sends a BYE //for source UE leg
		                to the IMS_S_CSCF entity 

		             }    
	            }
	    	} // End of TP_ISC_SCCAS_SRA_INV_04
    	}
    	Group "12.3.3.2 P-CSCF releasing the source access leg during PS to CS SRVCC"{
    		
    		import all from Sip_Common;	
    		Test Purpose {
        
	        TP Id TP_ISC_SCCAS_SRA_BYE_01
	        
	        Test objective  "Verify that the SCCAS distinguish SIP INVITE with STN-SR and not release source leg"
	        
	        Reference 
	            "ETSI TS 124 237 [1], Clause 12.3.3.2"
	        
	        Config Id CFG_SCCAS_01
	        
	        PICS Selection NONE //SCCAS_PS2CS_SRVCC 
	                
	        Initial conditions with {
	            the UE entity isRegisteredTo the IMS_A and 
	            the UE entity hasEstablishedDialog the SCCAS_UE_TERM
	        }
	        
	        Expected behaviour
	            ensure that {
	            	when {
	                    the IUT entity receives a BYE containing
	                        From indicating value PX_IMS_S_CSCF_SIP_URI,
                            To indicating value PX_UE_A_SIP_URI,
                            CallId indicating value PX_UE_A_CALLID,
                            Via indicating value PX_UE_A_VIA,
	                        Reason containing Cause indicating value "503";
	                        ;
	                    from the IMS_S_CSCF entity
	                }
	                then {
	                	the IUT entity receives a INVITE and
	                	the IUT entity not sends a BYE //forÂ¸ source UE leg
		                to the IMS_S_CSCF entity 

		             }    
	            }
	    	} // End of TP_ISC_SCCAS_SRA_BYE_01
    		
    	}
    	Group "12.3.3.3 P-CSCF releasing the source access leg when call is in alerting phase"{
    		
    	}
    	Group "12.3.3.4 PS to CS SRVCC cancelled by MME/SGSN or release of the target access leg for an ongoing session"{
    		
    		import all from Sip_Common;	
    		Test Purpose {
        
	        TP Id TP_ISC_SCCAS_SRA_BYE_02
	        
	        Test objective  "Verify that the SCCAS distinguish SIP BYE with STN-SR and release source leg after OperatiorSpecificTimer timeout"
	        
	        Reference 
	            "ETSI TS 124 237 [1], Clause 12.3.3.4"
	        
	        Config Id CFG_SCCAS_01
	        
	        PICS Selection NONE //SCCAS_PS2CS_SRVCC 
	                
	        Initial conditions with {
	            the UE entity isRegisteredTo the IMS_A and 
	            the UE entity hasEstablishedDialog the SCCAS_UE_TERM and 
	            the UE entity hasEstablishedPS2CSDialog    
	        }
	        
	        Expected behaviour
	            ensure that {
	            	when {
	                    the IUT entity receives a BYE containing
	                        RequestUri indicating value PX_STNSR_URI,
	                        From indicating value PX__SIP_URI,
	                        To indicating value PX__SIP_URI,
	                        CallId indicating value PX_STI_CALLID,
	                        Via indicating value PX_STNSR_VIA,
	                        Contact,
	                        TargetDialog containing "dialog info from PS session", 
	                        Require indicating value "tdialog",
	                        PAssertedIdentity indicating value PX_UE_CMSISDN
	                        SipMessageBody,
	                        Reason containing Cause indicating value "Reason Q.850 31";
	                        ;;
	                    from the IMS_S_CSCF entity
	                }
	                then {
	                	the IUT entity sends a r_200_Ok_BYE and
	                	the IUT entity on timerOperatorSpecificTimeout sends a BYE //for source UE leg
		                to the IMS_S_CSCF entity 
		             }    
	            }
	    	} // End of TP_ISC_SCCAS_SRA_BYE_02
	    	
	    	Test Purpose {
        
	        TP Id TP_ISC_SCCAS_SRA_BYE_03
	        
	        Test objective  "Verify that the SCCAS distinguish SIP BYE with STN-SR and release source leg on BYE Cause different from Cause Q850 31"
	        
	        Reference 
	            "ETSI TS 124 237 [1], Clause 12.3.3.4"
	        
	        Config Id CFG_SCCAS_01
	        
	        PICS Selection NONE //SCCAS_PS2CS_SRVCC 
	                
	        Initial conditions with {
	            the UE entity isRegisteredTo the IMS_A and 
	            the UE entity hasEstablishedDialog the SCCAS_UE_TERM and 
	            the UE entity hasEstablishedPS2CSDialog
	        }
	        
	        Expected behaviour
	            ensure that {
	            	when {
	                    the IUT entity receives a BYE containing
	                        RequestUri indicating value PX_STNSR_URI,
	                        From indicating value PX__SIP_URI,
	                        To indicating value PX__SIP_URI,
	                        CallId indicating value PX_STI_CALLID,
	                        Via indicating value PX_STNSR_VIA,
	                        Contact,
	                        TargetDialog containing "dialog info from PS session", 
	                        Require indicating value "tdialog",
	                        PAssertedIdentity indicating value PX_UE_CMSISDN
	                        SipMessageBody,
	                        Reason containing Cause not indicating value "Reason Q.850 31";
	                        ;;
	                    from the IMS_S_CSCF entity
	                }
	                then {
	                	the IUT entity sends a r_200_Ok_BYE and
	                	the IUT entity sends a BYE //for source UE leg
		                to the IMS_S_CSCF entity 

		             }    
	            }
	    	} // End of TP_ISC_SCCAS_SRA_BYE_03
    		
    	}
    	
    	Group "12.3.3.5 PS to CS SRVCC cancelled by MME/SGSN or release of the target access leg for a session in an early dialog phase"{
    		
    		Group "12.3.3.5.1 SCC AS serving an originating user"{
    			
    			import all from Sip_Common;
    			
	    		Test Purpose {
	        
		        TP Id TP_ISC_SCCAS_SRA_CNL_01
		        
		        Test objective  "Verify that the SCCAS distinguish SIP CANCEL and release session transfered leg after OperatiorSpecificTimer timeout"
		        
		        Reference 
		            "ETSI TS 124 237 [1], Clause 12.3.3.5.1"
		        
		        Config Id CFG_SCCAS_01
		        
		        PICS Selection NONE //SCCAS_PS2CS_SRVCC 
		                
		        Initial conditions with {
		            the UE entity isRegisteredTo the IMS_A and 
		            the UE entity hasInitiatedDialogWith the SCCAS_UE_TERM and
		            the UE entity hasInitiatedPS2CSinEarlydialog
		        }
		        
		        Expected behaviour
		            ensure that {
		            	when {
		                    the IUT entity receives a CANCEL containing
		                        RequestUri indicating value PX_STNSR_URI,
		                        From indicating value PX__SIP_URI,
		                        To indicating value PX__SIP_URI,
		                        CallId indicating value PX_STI_CALLID,
		                        Via indicating value PX_STNSR_VIA,
		                        Contact,
		                        TargetDialog containing "dialog info from PS session", 
		                        Require indicating value "tdialog",
		                        PAssertedIdentity indicating value PX_UE_CMSISDN
		                        SipMessageBody,
		                        Reason containing Cause not indicating value "Reason Q.850 31";
		                        ;;
		                    from the IMS_S_CSCF entity
		                }
		                then {
		                	the IUT entity sends a r_200_Ok_CANCEL and
		                	the IUT entity on timerOperatorSpecificTimeout sends a CANCEL
		                    to the IMS_S_CSCF entity 	
			             }    
		            }
		    	} // End of TP_ISC_SCCAS_SRA_CNL_01
    		}
    		Group "12.3.3.5.2 SCC AS serving a terminating user"{
    			
    		}
    		
    	}
    	
    } // end Group "12.3.3 SCC AS procedures for PS to CS SRVCC, abnormal case"
    
    Group "12.3.4 SCC AS procedures for PS to CS access transfer when call is in alerting phase or pre-alerting phase"{
    	 	
    	Group "12.3.4.2 SCC AS procedures for PS to CS access transfer for terminating call in alerting phase or pre-alerting phase using PS to CS SRVCC procedure"
	    {		
	    	import all from Sip_Common;	
    	
    		Test Purpose {
        
		        TP Id TP_ISC_SCCAS_PCT_INV_01
		        
		        Test objective  "Verify that SCC AS correctly recognizes and initiated for PS to CS access transfer for terminating call in pre-alerting phase using PS to CS SRVCC procedure"
		        
		        Reference 
		            "ETSI TS 124 237 [1], Clause 12.3.4.2"
		        
		        Config Id CFG_SCCAS_01
		        
		        PICS Selection NONE 
		                
		        Initial conditions with {
		            the UE entity isRegisteredTo the IMS 
		        }
		        
		        Expected behaviour
		            ensure that {
		            	when {
		                   the IUT entity receives an INVITE containing
		                        From indicating value PX_UE_A_SIP_URI,
		                        To indicating value PX_UE_B_SIP_URI,
		                        CallId indicating value PX_UE_A_CALLID,
		                        Via indicating value PX_UE_A_VIA,
		                        Route indicating value PX_UE_A_SERVICE_ROUTE,
		                        Contact containing 
		                        	g3gppps2csSrvccTermPreAlerting;;                          	
		                    from the IMS_S_CSCF entity
		                }
		                then {
		                	the IUT entity sends a r_183_SessionProgress 
			                to the IMS_S_CSCF entity 
	
			             }    
		            }
		    	} // End of TP_ISC_SCCAS_PCT_INV_01		    	
		    	
		    } // end Group "12.3.4.2 SCC AS procedures for PS to CS access transfer for terminating call in alerting phase or pre-alerting phase using PS to CS SRVCC procedure"
	    	
	    	Group "12.3.4.3 SCC AS procedures for PS to CS access transfer for originating call in alerting phase or pre-alerting phase using PS to CS SRVCC procedure"
	    	{
	    		
	    		import all from Sip_Common;	
	    	
		    	Test Purpose {
	        
		        TP Id TP_ISC_SCCAS_PCT_INV_02
		        
		        Test objective  "Verify that SCC AS correctly recognizes and initiated for PS to CS access transfer for originating call in pre-alerting phase using PS to CS SRVCC procedure"
		        
		        Reference 
		            "ETSI TS 124 237 [1], Clause 12.3.4.3"
		        
		        Config Id CFG_SCCAS_01
		        
		        PICS Selection NONE 
		                
		        Initial conditions with {
		            the UE entity isRegisteredTo the IMS 
		        }
	        
		        Expected behaviour
		            ensure that {
		            	when {
		                   the IUT entity receives an INVITE containing
		                        From indicating value PX_UE_A_SIP_URI,
		                        To indicating value PX_UE_B_SIP_URI,
		                        CallId indicating value PX_UE_A_CALLID,
		                        Via indicating value PX_UE_A_VIA,
		                        Route indicating value PX_UE_A_SERVICE_ROUTE,
		                        Contact containing 
		                        	g3gppPs2csSrvccOrigPreAlerting;;                          	
		                    from the IMS_S_CSCF entity
		                }
		                then {
		                	the IUT entity sends a r_183_SessionProgress  // possible r_18x
			                to the IMS_S_CSCF entity 
	
			             }    
		            }
		    	} // End of TP_ISC_SCCAS_PCT_INV_02
	    		    	
	    	} // end Group "12.3.4.3 SCC AS procedures for PS to CS access transfer for originating call in alerting phase or pre-alerting phase using PS to CS SRVCC procedure"
	    	
	    	Group "12.3.4.4 SCC AS procedures for PS to CS access transfer of additional call"
	    	{
	    		
	    		import all from Sip_Common;	
	    		
		    	Test Purpose {
	        
		        TP Id TP_ISC_SCCAS_PCT_INV_03
		        
		        Test objective  "Verify that SCC AS correctly procedures for PS to CS access transfer of additional call"
		        
		        Reference 
		            "ETSI TS 124 237 [1], Clause 12.3.4.4"
		        
		        Config Id CFG_SCCAS_01
		        
		        PICS Selection NONE 
		                
		        Initial conditions with {
		            the UE entity isRegisteredTo the IMS  and
		            the IUT entity hasAchievedInitialINVITE // TODO: INVITE contains: g3gppSrvccAlerting 
		            // TODO: and more conditions to distinguish subchapter from 12.3.4.2, 12.3.4.3
		        }
		        
		        Expected behaviour
		            ensure that {
		            	when {
		                   the IUT entity receives an r_180_Ringing                    	
		                   from the IMS_S_CSCF entity
		                }
		                then {
		                	the IUT entity sends an REFER containing
	                        From indicating value PX_UE_A_SIP_URI,
	                        To indicating value PX_UE_B_SIP_URI,
	                        CallId indicating value PX_UE_A_CALLID,
	                        Via indicating value PX_UE_A_VIA,
	                        Route indicating value PX_UE_A_SERVICE_ROUTE,
	                        ReferSub indicating value false,	
							Supported indicating value "norefersub";
							to the IMS_S_CSCF entity
			             }    
		            }
		    	} // End of TP TP_ISC_SCCAS_PCT_INV_03
		    	
		    } // end Group 12.3.4.4 SCC AS procedures for PS to CS access transfer of additional call
    	
    } // end Group "12.3.4 SCC AS procedures for PS to CS access transfer when call is in alerting phase or pre-alerting phase"
//    
//    Group "12.3.5 SCC AS procedures for PS to CS access transfer: PS to CS SRVCC enhancement using ATCF"{
//    	
//    	import all from Sip_Common;    	
//    }// end Group "12.3.5 SCC AS procedures for PS to CS access transfer: PS to CS SRVCCenhancement using ATCF"
//    
//    Group "12.3.6 SCC AS procedures for PS to CS access transfer, vSRVCC"{
//    	
//    	import all from Sip_Common;    	
//    }// end Group "12.3.6 12.3.6.0 SCC AS procedures for PS to CS access transfer, vSRVCC"
//    
//    Group "12.3.7 SCC AS procedures for handling of SIP OPTIONS request"{
//    	
//    	import all from Sip_Common;	
//    } // end Group "12.3.7 SCC AS procedures for handling of SIP OPTIONS request"
//    
//    Group "12.3.8 Removal of non-transferred audio media components and superfluous sessions"{
//    	
//    	import all from Sip_Common;	
//    } // end Group "12.3.8 Removal of non-transferred audio media components and superfluous sessions"
//            
//    Group "12.3.9 Charging correlation"{
//    	
//    	import all from Sip_Common;	
//    } // end Group "12.3.9 Charging correlation"
//    
//    Group "12.3.10 SCC AS procedures for CS to PS SRVCC"{
//    	
//    	import all from Sip_Common;	
//    } // end Group "12.3.10 SCC AS procedures for CS to PS SRVCC"
//    
    Group "12.3.11 SCC AS procedures when the access transfer is completed"{
    	
    	import all from Sip_Common;	
    	
    	
    	Test Purpose {
	        
		        TP Id TP_ISC_SCCAS_PCT_INV_03
		        
		        Test objective  "Verify that l"
		        
		        Reference 
		            "ETSI TS 124 237 [1], Clause 12.3.4.4"
		        
		        Config Id CFG_SCCAS_01
		        
		        PICS Selection NONE 
		                
		        Initial conditions with {
		            the UE entity isRegisteredTo the IMS  and
		            the IUT entity hasAchievedInitialINVITE // TODO: INVITE contains: g3gppSrvccAlerting 
		            // TODO: and more conditions to distinguish subchapter from 12.3.4.2, 12.3.4.3
		        }
		        
		       	Expected behaviour
	            ensure that {
	            	when {
	                    the IUT entity receives a BYE containing
	                        RequestUri indicating value PX_STNSR_URI,
	                        From indicating value PX__SIP_URI,
	                        To indicating value PX__SIP_URI,
	                        CallId indicating value PX_STI_CALLID,
	                        Via indicating value PX_STNSR_VIA,
	                        Contact,
	                        TargetDialog containing "dialog info from PS session", 
	                        Require indicating value "tdialog",
	                        PAssertedIdentity indicating value PX_UE_CMSISDN
	                        SipMessageBody,
	                        Reason containing Cause indicating value "Reason Q.850 1"; // should be different then 31
	                        ;;
	                    from the IMS_S_CSCF entity
	                }
	                then {
	                	the IUT entity sends a r_200_Ok_BYE and
	                	the IUT entity on timerOperatorSpecificTimeout sends a BYE //for source UE leg
		                to the IMS_S_CSCF entity 
		             }    
	            }
		    } // End of TP TP_ISC_SCCAS_PCT_INV_03
    	
    } // end Group "12.3.11 SCC AS procedures when the access transfer is completed"
    
}// End of Package TP_SCCAS_Chapter_9_3

