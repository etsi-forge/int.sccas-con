/*
Copyright (c) ETSI 2019-2020.

This software is subject to copyrights owned by ETSI. Non-exclusive permission
is hereby granted, free of charge, to copy, reproduce and amend this file
under the following conditions: It is provided "as is", without warranty of any
kind, expressed or implied.

ETSI shall never be liable for any claim, damages, or other liability arising
from its use or inability of use.This permission does not apply to any documentation
associated with this file for which ETSI keeps all rights reserved. The present
copyright notice shall be included in all copies of whole or part of this
file and shall not imply any sub-license right.
*/

/* interface at SCCAS */
Package TP_SCCAS {
    
      
    
    Group "9.3.3 SCC AS procedures for CS to PS access transfer"
    {
    	import all from Sip_Common;
    	 
    	Test Purpose {
    		
    	// When the SCC AS receives a 
    	// SIP INVITE request due to 
    	// STI on the (page 20)
    	// Target Access Leg offering (RFC 3891 - replaces header field, 
    	// PS media only (PS Packet Switch),
		// SCC AS shall follow the procedures specified in subclause 10.3.2.
		
        TP Id TP_ISC_SCCAS_CPT_INV_01 
        
        Test objective "Verify that the P-CSCF successfully processes an initial INVITE (Originating Leg) with dynamic STI."
        
        Reference 
            "ETSI TS 124 237 [1], Clauses 9.3.3 and 10.3.2" 
        
        Config Id CFG_SCCAS_01
        
        PICS Selection NONE  // TODO
        
        Initial conditions with {
            the UE entity isRegisteredTo the IMS  // TODO
        }
        
        Expected behaviour
            ensure that {
                when {
                    the IUT entity receives an INVITE containing  	
                        From indicating value PX_UE_A_SIP_URI,		// this indicates dynamic STI
                        To indicating value PX_UE_B_SIP_URI,
                        CallId indicating value PX_UE_A_CALLID,
                        Via indicating value PX_UE_A_VIA,
                        Route indicating value PX_UE_A_SERVICE_ROUTE,
                        Supported indicating value "replaces",
                        PAccessNetworkInfo,
                        Replaces containing  // Replaces indicating value (RFC 3891)
                        	 call_id indicating value PX_call_id, // TODO PX
                        	 from_tag indicating value PX_from_tag, // TODO PX
                        	 to_tag indicating value PX_to_tag // TODO PX                   
                        MessageBody containing
                            SDP containing  // SDP: Session Description Protocol
                                Media indicating value PX_PSMediaOnly, // TODO: PX for media only
                                Version indicating value "0";;;;
                    from the IMS_S_CSCF entity
                }
                then {
                    the IUT entity sends an r_200_Ok containing
                        From indicating value PX_UE_A_SIP_URI,
                        To indicating value PX_UE_B_SIP_URI,
                        CallId indicating value PX_UE_A_CALLID,
                        Via indicating value PX_UE_A_VIA,
                        Route indicating value PX_UE_A_SERVICE_ROUTE,
                        PAccessNetworkInfo,
                        ContentType indicating value "application/sdp",
                        ContentLength,
                        MessageBody containing
                            SDP containing
                             	Media indicating value PX_PSMediaOnly, // TODO: PX for media only
                                Version indicating value "0";;;
                     to the IMS_S_CSCF entity
                	}
            	}
            
            } // end TP TP_SCCAS_CS_to_PS_access_transfer_01
            
            
            // Testpurpose 2: When the SCC AS receives a SIP INVITE request due to static STI, the SCC AS shall:
            Test Purpose {
    		
	    	// When the SCC AS receives a 
	    	// SIP INVITE request due to 
	    	// STI on the (page 20)
	    	// Target Access Leg offering (RFC 3891 - replaces header field, 
	    	// PS media only (PS Packet Switch),
			// SCC AS shall follow the procedures specified in subclause 10.3.2.
			
	        // TP_ISC_SCCAS_XXX_INV_01
	        TP Id TP_ISC_SCCAS_CPT_INV_02 
	        
	        Test objective "Verify that the P-CSCF successfully processes an initial INVITE (Originating Leg) with static STI."
	        
	        Reference 
	            "ETSI TS 124 237 [1], Clauses 9.3.3" 
	        
	        Config Id CFG_SCCAS_01
	        
	        PICS Selection NONE  // TODO
	        
	        Initial conditions with {
	            the UE entity isRegisteredTo the IMS  // TODO
	        }
	        
	        Expected behaviour
	            ensure that {
	                when {
	                    the IUT entity receives an INVITE containing  	
	                        From indicating value PX_UE_A_TEL_URI,		// this indicates static STI 
	                        To indicating value PX_UE_B_SIP_URI,
	                        CallId indicating value PX_UE_A_CALLID,
	                        Via indicating value PX_UE_A_VIA,
	                        Route indicating value PX_UE_A_SERVICE_ROUTE,
	                        Supported indicating value "replaces",
	                        PAccessNetworkInfo,
	                        Replaces containing  // Replaces indicating value (RFC 3891)
	                        	 call_id indicating value PX_call_id, // TODO PX
	                        	 from_tag indicating value PX_from_tag, // TODO PX
	                        	 to_tag indicating value PX_to_tag // TODO PX                   
	                        MessageBody containing
	                            SDP containing  // SDP: Session Description Protocol
	                                Media indicating value PX_PSMediaOnly, // TODO: PX for media only
	                                Version indicating value "0";;;;
	                    from the IMS_S_CSCF entity
	                }
	                then {
	                    the IUT entity sends an r_200_Ok containing
	                        From indicating value PX_UE_A_TEL_URI,
	                        To indicating value PX_UE_B_SIP_URI,
	                        CallId indicating value PX_UE_A_CALLID,
	                        Via indicating value PX_UE_A_VIA,
	                        Route indicating value PX_UE_A_SERVICE_ROUTE,
	                        PAccessNetworkInfo,
	                        ContentType indicating value "application/sdp",
	                        ContentLength,
	                        MessageBody containing
	                            SDP containing
	                             	Media indicating value PX_PSMediaOnly, // TODO: PX for media only
	                                Version indicating value "0";;;
	                     to the IMS_S_CSCF entity
	                	}
	            	}
            
            } // end TP_SCCAS_CS_to_PS_access_transfer_02
            
            
            // Test puposes 3: Upon receiving the SIP 2xx response to the SIP re-INVITE request the SCC AS shall send the SIP 200 (OK) response
			// to the SIP INVITE request due to static STI on the target access leg populated as follows:
          	Test Purpose {
    		
	    	// Note: Consider alternative with: 
	    	// if the SCC AS supports CS to PS dual radio access transfer for calls in alerting phase according to operator policy
		
        	
	        TP Id TP_ISC_SCCAS_CPT_RIN_01
	        
	        Test objective "Verify that the P-CSCF successfully processes an re-INVITE (Originating Leg)"
	        
	        Reference 
	            "ETSI TS 124 237 [1], Clauses 9.3.3" 
	        
	        Config Id CFG_SCCAS_01
	        
	        PICS Selection NONE  // TODO
	        
	        Initial conditions with {
	            the UE entity isRegisteredTo the IMS and // TODO
	            the UE entity previouslyEstablishedCallWith 
	        }
	        
	        Expected behaviour
	            ensure that {
	                when {
	                    the IUT entity receives an INVITE containing  	// re-invite
	                        From indicating value PX_UE_A_SIP_URI,		
	                        To indicating value PX_UE_B_SIP_URI,
	                        CallId indicating value PX_UE_A_CALLID,
	                        Via indicating value PX_UE_A_VIA,
	                        Route indicating value PX_UE_A_SERVICE_ROUTE,
	                        Supported indicating value "replaces",
	                        PAccessNetworkInfo,
	                        Replaces containing  // Replaces indicating value (RFC 3891)
	                        	 call_id indicating value PX_call_id, // TODO PX
	                        	 from_tag indicating value PX_from_tag, // TODO PX
	                        	 to_tag indicating value PX_to_tag // TODO PX                   
	                        MessageBody containing
	                            SDP containing  // SDP: Session Description Protocol
	                                Media indicating value PX_PSMediaOnly, // TODO: PX for media only
	                                Version indicating value "0";;;;
	                    from the IMS_S_CSCF entity
	                }
	                then {
	                    the IUT entity sends an r_200_Ok containing
	                        From indicating value PX_UE_A_SIP_URI,
	                        To indicating value PX_UE_B_SIP_URI,
	                        CallId indicating value PX_UE_A_CALLID,
	                        Via indicating value PX_UE_A_VIA,
	                        Route indicating value PX_UE_A_SERVICE_ROUTE,
	                        PAccessNetworkInfo,
	                        ContentType indicating value "application/sdp",
	                        ContentLength,
	                        MessageBody containing
	                            SDP containing
	                             	Media indicating value PX_PSMediaOnly, // TODO: PX for media only
	                                Version indicating value "0";;;
	                     to the IMS_S_CSCF entity
	                	}
	            	}
	            
	            } // end TP_SCCAS_CS_to_PS_access_transfer_03
            
            
            // Test puposes 4: Upon receiving the SIP ACK request originated from the SC UE, the SCC AS shall:
            Test Purpose {
            	
            TP Id TP_ICS_SCCAS_XXX_YYY_04  
            
            //Upon receiving the SIP ACK request originated from the SC UE, the SCC AS shall:
			//1) release the source access leg as specified in subclause 9.3.6.; and ...
			
            //the source access leg is an ongoing session containing only an active or inactive media component or a session in
			//an early dialog phase on the terminating side, send a SIP BYE request on the source access leg in accordance
			//with 3GPP TS 24.229 [2];
        
        	Test objective  "Verify that the P-CSCF successfully processes an ACK and release the source access leg."
        
        	Reference 
            "ETSI TS 124 237 [1], Clauses 9.3.3 and 9.3.6." 
        
        	Config Id CFG_SCCAS_01
        
       	 	PICS Selection NONE  // TODO
        
        	Initial conditions with {
            	the UE entity isRegisteredTo the IMS and
            	the UE entity hasReceived200OkOnInitialRequestForDialogWith
        	}
        	
        	Expected behaviour
            	ensure that {
                	when {                 
                    	the IUT entity receives an ACK containing
                        From indicating value PX_UE_A_SIP_URI,
                        To indicating value PX_UE_B_SIP_URI,
                        CallId indicating value PX_UE_A_CALLID,
                        Via indicating value PX_UE_A_VIA,
                        Route indicating value PX_UE_A_SERVICE_ROUTE;
                    from the IMS_S_CSCF entity
                }                    	             	
              	then {
                    	the IUT entity sends an BYE containing
                        From indicating value PX_UE_A_SIP_URI,
                        To indicating value PX_UE_B_SIP_URI,
                        CallId indicating value PX_UE_A_CALLID,
                        Via indicating value PX_UE_A_VIA,
                        Route indicating value PX_UE_A_SERVICE_ROUTE;
                    to the IMS_S_CSCF entity
                    }
                }
            	
            
            } // end TP TP_ICS_SCCAS_XXX_YYY_04
            
    	
    } // end Group "9.3.3 SCC AS procedures for CS to PS access transfer"
    
    Group "9.3.4 SCC AS procedures for CS to PS access transfer with MSC server assisted mid-call feature"
    {
    	

    	
    } // end Group 9.3.4 SCC AS procedures for CS to PS access transfer with MSC server assisted mid-call feature
    
    Group "9.3.5 SCC AS procedures for PS to CS dual radio access transfer of calls in an early dialog phase"
    {
    	Group "9.3.5.2 SCC AS procedures for PS to CS dual radio access transfer of a originating session in the alerting phase"
    	{
    		
    		import all from Sip_Common;
    	
    	 
            Test Purpose {
            	
				// When the SCC AS receives a SIP INVITE request due to PS to CS STN and if there are one or more dialogs in an early
				// dialog phase supporting a session with active speech media component such that:
				//		1) all dialogs are early dialogs created by the same SIP INVITE request;
				//		2) a SIP 180 (Ringing) response to SIP INVITE request was received in at least one of those early dialogs;
				//		3) a g.3gpp.drvcc-alerting feature-capability indicator as described in annex C was included in a Feature-Caps
				//		header field by the SCC AS in the SIP 180 (Ringing) response; and
				//		4) the Contact header field in the initial SIP INVITE request sent by the SC UE towards the SCC AS included the
				//		g.3gpp.drvcc-alerting media feature tag as described in annex C,
				// then the SCC AS shall for each early dialog send an SIP UPDATE request towards the remote UE and populate each
				// SIP UPDATE request as follows:
				// 		1) set the Request-URI set to the URI contained in the Contact header field returned at the creation of the dialog
				// 		with the remote UE;
				// 		2) the Contact header field set to the Contact header field provided by the served UE at the creation of the dialog
				// 		with the remote UE; and
				//		3) a new SDP offer, including:
				//			a) if the remote leg is not a precondition enabled dialog, the media characteristics as received in the SIP
				//			INVITE request due to PS to CS STN but excluding any precondition mechanism specific SDP attributes, by
				//			following the rules of 3GPP TS 24.229 [2];
				//			b) if the remote leg is a precondition enabled dialog, include a new SDP offer including:
				//				- the media characteristics as received in the SIP INVITE request due to PS to CS STN (including any
				//				precondition mechanism specific SDP attributes); and
				//				- if the SIP INVITE request due to PS to CS STN is not a precondition enabled initial SIP INVITE request,
				//				indicate preconditions as met, using the segmented status type, as defined in IETF RFC 3312 [88] and
				//				IETF RFC 4032 [89], as well as the strength-tag value "mandatory" for the local segment and the
				//				strength-tag value either "optional" or as specified in RFC 3312 [88] and RFC 4032 [89] for the remote
				//				segment.
				
				// this TP: only case A
            	
            	TP Id TP_ICS_SCCAS_PCT_UPD_01 
            	
            	Test objective "Verify that the SCC AS sends a SIP UPDATE after receiving a SIP INVITE request due to PS to CS STN and if there are one or more dialogs in an early dialog phase and the remote leg is not a precondition enabled dialog"
            	
            	Reference 
	            "ETSI TS 124 237 [1], Clauses 9.3.5.2" 
	        
	        	Config Id CFG_SCCAS_01
	        
	       	 	PICS Selection NONE  // TODO
	        
	        	Initial conditions with {
	            	the UE entity isRegisteredTo the IMS 
					// TODO: 
					// here are one or more dialogs in an early dialog phase supporting a session with active speech media component such that:
					//		1) all dialogs are early dialogs created by the same SIP INVITE request;
					//		2) a SIP 180 (Ringing) response to SIP INVITE request was received in at least one of those early dialogs;
					//		3) a g.3gpp.drvcc-alerting feature-capability indicator as described in annex C was included in a Feature-Caps
					//		header field by the SCC AS in the SIP 180 (Ringing) response; and
					//		4) the Contact header field in the initial SIP INVITE request sent by the SC UE towards the SCC AS included the
					//		g.3gpp.drvcc-alerting media feature tag as described in annex C,
					// and
					// the remote leg is not a precondition enabled dialog
	        	}
	        	
	        	Expected behaviour
            	ensure that {
                	when {                      	     
                    	the IUT entity receives an INVITE containing
                        From indicating value PX_UE_A_SIP_URI,
                        To indicating value PX_UE_B_SIP_URI,
                        CallId indicating value PX_UE_A_CALLID,
                        Via indicating value PX_UE_A_VIA,
                        Route indicating value PX_UE_A_SERVICE_ROUTE;
                    from the IMS_S_CSCF entity
                }                    	             	
              	then {
                    	the IUT entity sends an UPDATE containing
                        From indicating value PX_UE_A_SIP_URI,
                        To indicating value PX_UE_B_SIP_URI,
                        CallId indicating value PX_UE_A_CALLID,
                        Via indicating value PX_UE_A_VIA,
                        Route indicating value PX_UE_A_SERVICE_ROUTE,
		                // 1) set the Request-URI set to the URI contained in the Contact header field returned at the creation of the dialog
						// with the remote UE;
						Contact indicating value "set to the Contact header field provided by the served UE at the creation of the dialog",// 2) the Contact header field set to the Contact header field provided by the served UE at the creation of the dialog with the remote UE
                    	ContentType indicating value "application/sdp", 
                        	MessageBody containing  // 3) a new SDP offer, including:
                            	SDP containing
                            		Media indicating value "the media characteristics as received in the SIP INVITE request due to PS to CS STN (including any precondition mechanism specific SDP attributes)";
                        		;
                        	;
                    to the IMS_S_CSCF entity
                    }
                }
            	
            } // end TP_ICS_SCCAS_PCT_UPD_01
            
            
            
            Test Purpose {
            	
            	
				// For each SIP 200 (OK) response to the SIP UPDATE request (triggered by the SIP INVITE request due to PS to CS
				// STN) from a remote UE the SCC AS shall:
				// 		1) if one of the following is true:
				// 			A) if the remote leg is not a precondition enabled dialog;
				// 			B) if the remote leg is a precondition enabled dialog, the SIP INVITE request due to PS to CS STN is a
				// 			precondition enabled initial SIP INVITE request and both local and remote preconditions are met:
				// send a SIP provisional response to the SIP INVITE request due to PS to CS STN following the rules of
				// 3GPP TS 24.229 [2] with the response code corresponding to the actual dialog state populated with:
				// 		- an SDP answer based on the SDP answer received from the remote UE; and
				// 		- the last received P-Early-Media header field, including the SIP 2xx response to the SIP UPDATE request, if a PEarly-
				// 		Media has been received from the remote UE.
				
				// This TP: only case A
				
            	TP Id TP_ICS_XXX_YYY_02
            	
            	Test objective "Verify that the SCC AS sends SIP provisional response to the SIP INVITE request due to PS to CS STN"
            	
            	Reference 
	            "ETSI TS 124 237 [1], Clauses 9.3.5.2" 
	        
	        	Config Id CFG_SCCAS_01
	        
	       	 	PICS Selection NONE  // TODO
	        
	        	Initial conditions with {
	            	the UE entity isRegisteredTo the IMS 
					// a SIP INVITE request due to PS to CS STN tooks place
					// and
					// SCC AS has send a SIP UPDATE request according to TP TP_ICS_SCCAS_PCT_UPD_01
					// and
					// the remote leg is not a precondition enabled dialog
	        	}
	        	
	        	Expected behaviour
            	ensure that {
                	when {                      	     
                    	the IUT entity receives an r_200_Ok containing
                        From indicating value PX_UE_A_SIP_URI,
                        To indicating value PX_UE_B_SIP_URI,
                        CallId indicating value PX_UE_A_CALLID,
                        Via indicating value PX_UE_A_VIA,
                        Route indicating value PX_UE_A_SERVICE_ROUTE;
                    from the IMS_S_CSCF entity
                }                    	             	
              	then {
                    	the IUT entity sends an r_1xx_Any containing
                        From indicating value PX_UE_A_SIP_URI,
                        To indicating value PX_UE_B_SIP_URI,
                        CallId indicating value PX_UE_A_CALLID,
                        Via indicating value PX_UE_A_VIA,
                        Route indicating value PX_UE_A_SERVICE_ROUTE,
		                PEarlyMedia indicating value "the last received P-Early-Media header field",
                    	ContentType indicating value "application/sdp", 
                        	MessageBody containing  // 3) a new SDP offer, including:
                            	SDP containing
                            		Media indicating value "SDP answer based on the SDP answer received from the remote UE";
                        		;
                        	;
                    to the IMS_S_CSCF entity
                    }
                }
            }
            
            
    	} // end Group "9.3.5.2 SCC AS procedures for PS to CS dual radio access transfer of a originating session in the alerting phase"

		Group "9.3.5.3 SCC AS procedures for PS to CS dual radio, access transfer of a originating session in the pre-alerting phase"
		{
			
			import all from Sip_Common;
			
			Test Purpose {
				
			// When the SCC AS receives a SIP INVITE request due to PS to CS STN and if there are zero, one or more dialogs in an
			// early dialog phase supporting a session with active speech media component such that:
			// 		1) all dialogs are early dialogs created by the same SIP INVITE request;
			// 		2) a SIP 180 (Ringing) response to the SIP INVITE request has not been received yet in any of the existing dialogs;
			// 		3) the SCC AS included a g.3gpp.ps2cs-drvcc-orig-pre-alerting feature-capability indicator as described in annex C
			// 		in a Feature-Caps header field of SIP 18x responses; and
			// 		4) the Contact header field in the initial SIP INVITE request sent by the SC UE towards the SCC AS included a
			// 		g.3gpp.ps2cs-drvcc-orig-pre-alerting media feature tag as described in annex C,
			// then the SCC AS shall for each early dialog send a SIP UPDATE request towards the remote UE.
			// Each SIP UPDATE request shall be populated as follows:
			// 		1) the Request-URI set to the URI contained in the Contact header field returned at the creation of the dialog with
			// 		the remote UE;
			//		2) the Contact header field set to the Contact header field provided by the served UE at the creation of the dialog
			//		with the remote UE; and
			//		3) an new SDP offer, including
			//			a) if the remote leg is not a precondition enabled dialog, the media characteristics as received in the SIP
			//			INVITE request due to PS to CS STN but excluding any precondition mechanism specific SDP attributes, by
			//			following the rules of 3GPP TS 24.229 [2];
			//			b) if the remote leg is a precondition enabled dialog, include a new SDP offer including:
			//				- the media characteristics as received in the SIP INVITE request due to PS to CS STN (including any
			//				precondition mechanism specific SDP attributes); and
			//				- if the SIP INVITE request due to PS to CS STN is not a precondition enabled initial SIP INVITE request,
			//				indicate preconditions as met, using the segmented status type, as defined in IETF RFC 3312 [88] and
			//				IETF RFC 4032 [89], as well as the strength-tag value "mandatory" for the local segment and the
			//				strength-tag value either "optional" or as specified in RFC 3312 [88] and RFC 4032 [89] for the remote
			//				segment.
			
			TP Id TP_ICS_SCCAS_PCT_INV_01
            	
            Test objective "Verify that the SCC AS send a SIP UPDATE request towards the remote UE after receiving a SIP INVITE request due to PS to CS STN in early dialog phase supporting a session with active speech media component such"
            
            Reference 
	            "ETSI TS 124 237 [1], Clauses 9.3.5.3" 
	        
	        	Config Id CFG_SCCAS_01
	        
	       	 	PICS Selection NONE  // TODO
	        
	        	Initial conditions with {
	            	the UE entity isRegisteredTo the IMS 
					// one dialog is early dialog 
					// and
					// a SIP 180 (Ringing) response to the SIP INVITE request has not been received yet in any of the existing dialogs
					// and
					// the SCC AS included a g.3gpp.ps2cs-drvcc-orig-pre-alerting feature-capability indicator as in a Feature-Caps header field of SIP 18x responses
					// and
					// the Contact header field in the initial SIP INVITE request sent by the SC UE towards the SCC AS included a g.3gpp.ps2cs-drvcc-orig-pre-alerting media feature tag as
					// and
					// the remote leg is not a precondition enabled dialog
	        	}
	        		        	
	        	Expected behaviour
            	ensure that {
                	when {                      	     
                    	the IUT entity receives an INVITE containing
                        From indicating value PX_UE_A_SIP_URI,
                        To indicating value PX_UE_B_SIP_URI,
                        CallId indicating value PX_UE_A_CALLID,
                        Via indicating value PX_UE_A_VIA,
                        Route indicating value PX_UE_A_SERVICE_ROUTE;
                    from the IMS_S_CSCF entity
                }                    	             	
              	then {
                    	the IUT entity sends an UPDATE containing
                        From indicating value PX_UE_A_SIP_URI,
                        To indicating value PX_UE_B_SIP_URI,
                        CallId indicating value PX_UE_A_CALLID,
                        Via indicating value PX_UE_A_VIA,
                        Route indicating value PX_UE_A_SERVICE_ROUTE,
		                PEarlyMedia indicating value "the last received P-Early-Media header field",
                    	ContentType indicating value "application/sdp", 
                        	MessageBody containing  // 3) a new SDP offer, including:
                            	SDP containing
                            		Media indicating value "the media characteristics as received in the SIP INVITE request due to PS to CS STN but excluding any precondition mechanism specific SDP attributes";
                        		;
                        	;
                    to the IMS_S_CSCF entity
                    }
                }
            
			} // end TP_ICS_SCCAS_PCT_INV_01
			
			
		} // end Group "9.3.5.3 SCC AS procedures for PS to CS dual radio, access transfer of a originating session in the prealerting phase"
		
		Group "9.3.5.4 SCC AS procedures for PS to CS dual radio access transfer of an additional session in an early dialog phase"
		{
			
			
		import all from Sip_Common;
    	
    	Test Purpose {
    		
    		TP Id TP_ICS_SCCAS_PCT_REF_01
    		
    		Test objective "Verify that the SCC AS populate a SIP REFER request to transfer an additional session in PS to CS dual radio access"
    		
    		Reference 
            "ETSI TS 124 237 [1], Clauses 9.3.5.4" 
        
        	Config Id CFG_SCCAS_01
        
       	 	PICS Selection NONE  // TODO
        
        	Initial conditions with {
            	the UE entity isRegisteredTo the IMS 
				// TODO: initial condition SIP INVITE request to PS to CS STN
				// "In order to transfer an additional session on the originating side that can be in pre-alerting phase or in an alerting phase,
				// the SCC AS shall send a SIP REFER request in the
				// dialog created by the SIP INVITE request due to PS to CS STN"
        	}
    		
			// 1. the Refer-Sub header field with value "false" as specified in IETF RFC 4488 [20];
			// 2. the Require header field with value "norefersub" as specified in IETF RFC 4488 [20];
			// 3. the Refer-To header field containing the additional transferred session SCC AS URI for PS to CS dual radio,
			// where the URI also includes the following header fields containing the information related to the additional
			// transferred session:
			//		A. the Target-Dialog header field populated as specified in IETF RFC 4538 [11], containing the dialog identifier
			//		of an dialog in the early phase supporting session of the SC UE;
			//		B. the Require header field populated with the option tag value "tdialog";
			//		C. the To header field populated as specified in IETF RFC 3261 [19], containing the value of the P-Asserted-
			//		Identity provided by the remote UE during the session establishment;
			//		D. the From header field populated as specified in IETF RFC 3261 [19], containing the value of the P-Asserted-
			//		Identity provided by the SC UE during the session establishment;
			//		E. the Content-Type header field with "application/sdp";
			//		F. the URI header field with the hname "body" populated with SDP describing the media streams as negotiated
			//		in the session with the remote UE; and
			//		G. optionally the P-Asserted-Identity URI header field containing value of the P-Asserted-Identity header field
			//		of the received SIP INVITE request; and
			// 4. application/vnd.3gpp.state-and-event-info+xml MIME body populated as follows:
			//		A) if a SIP 180 (Ringing) response to the SIP INVITE request has already been received in any of the early
			//		dialogs associated with the originating early session not accepted yet, with the state-info XML element
			//		containing "early" and the direction XML element containing "initiator"; and
			//		B) if a SIP 180 (Ringing) response to the SIP INVITE request has not been received yet in any of the early
			//		dialogs associated with the originating early session not accepted yet, with the state-info XML element
			// 		containing "pre-alerting" and the direction XML element containing "initiator".
		    		
    		Expected behaviour
            	ensure that {
                	when {        
                	    // TODO: Trigger unclear for this refer    
                    	the IUT entity receives an ACK 

                    from the IMS_S_CSCF entity
                }                    	             	
              	then {
                    	the IUT entity sends an REFER containing
                        From indicating value PX_UE_A_SIP_URI,
                        To indicating value PX_UE_B_SIP_URI,
                        CallId indicating value PX_UE_A_CALLID,
                        Via indicating value PX_UE_A_VIA,
                        Route indicating value PX_UE_A_SERVICE_ROUTE,
                        ReferSub indicating value false,  			// 1. the Refer-Sub header field with value "false"
                        Require indicating value "norefersub",	// 2. the Require header field with value "norefersub"
                        ReferTo containing "a SIP URI with the Target-Dialog_URI_header_field"  // 3. the Refer-To header field containing the additional transferred session SCC AS URI for PS to CS dual radio, where the URI also includes the following header fields containing the information related to the additional transferred session:
                        	TargetDialog indicating value "TODO: dialog identifier of an dialog in the early phase supporting session of the SC UE", // A. the Target-Dialog header field populated, containing the dialog identifier of an dialog in the early phase supporting session of the SC UE;
                        	Require indicating value "tdialog", // B. the Require header field populated with the option tag value "tdialog"
                        	To indicating value "", // C. the To header field populated, containing the value of the P-Asserted-Identity provided by the remote UE during the session establishment;
                        	From indicating value "", // D. the From header field populated, containing the value of the P-Asserted-Identity provided by the SC UE during the session establishment;
                        	ContentType indicating value "application/sdp", // E. the Content-Type header field with "application/sdp";
                        	MessageBody containing  // F. the URI header field with the hname "body" populated with SDP describing the media streams as negotiated in the session with the remote UE
                            	SDP containing
                            		TODO indicating value "";
                        		;
                        	;,
                        	PAssertedIdentity indicating value ""; // G. optionally the P-Asserted-Identity URI header field containing value of the P-Asserted-Identity header field of the received SIP INVITE request
                        		
                    to the IMS_S_CSCF entity
                    }
                }
    		
    		} // end TP_ICS_SCCAS_PCT_REF_01
			
			
		} // end Group "9.3.5.4 SCC AS procedures for PS to CS dual radio access transfer of an additional session in an early dialog phase"
		
		Group "9.3.5.5 SCC AS procedures for PS to CS dual radio access transfer of a terminating session in the alerting phase"
		{
			import all from Sip_Common;
    	
    	 
            Test Purpose {
            	
			// When the SCC AS receives a SIP 488 (Not Acceptable Here) response to the SIP INVITE request creating the session
			// in the terminating alerting phase without an SDP MIME body and if the SCC AS supports PS to CS dual radio access
			// transfer for calls in alerting phase then the SCC AS shall:
			//		1) if a SIP 180 (Ringing) response to the SIP INVITE request has been received from the SC UE;
			//		2) if the SCC AS included a g.3gpp.ps2cs-drvcc-orig-pre-alerting feature-capability indicator as described in
			//		annex C in the SIP INVITE request; and
			//		3) if the Contact header field in the SIP 180 (Ringing) response request sent by the SC UE towards the SCC AS
			//		included a g.3gpp.drvcc-alerting media feature tag as described in annex C,
			// terminate the call over CS as follows:
			//		1) perform the actions according to the subclause 10.4.7 in 3GPP TS 24.292 [4] with the following clarifications:
			//			a) the URI in the Request-URI shall be set to C-MSISDN; and
			//			b) the P-Asserted-Identity header field set to:
			//				- if the SIP 180 (Ringing) response contained the g.3gpp.dynamic-stn media feature tag as described in
			//				annex C in the Contact header field, the dynamic STN; and
			//				- if the SIP 180 (Ringing) response does not contain the g.3gpp.dynamic-stn media feature tag as described
			//				in annex C in the Contact header field, the static STN.
            	
            	TP Id TP_ICS_SCCAS_PCT_REF_02 
            	
            	Test objective "Verify that the SCC AS terminates the call over CS after receiving a SIP 488"            	
    		
	    		Reference 
	            "ETSI TS 124 237 [1], Clauses 9.3.5.5 and 10.4.7 in 3GPP TS 24.292 [4]" 
	        
	        	Config Id CFG_SCCAS_01
	        
	       	 	PICS Selection NONE  // TODO
	        
	        	Initial conditions with {
	            	the UE entity isRegisteredTo the IMS 
					// TODO: 
					// SIP INVITE was sent with:
						//  creating the session in the terminating alerting phase without an SDP MIME body
					// SCC AS supports PS to CS dual radio access
	        	}
	        	
	        	Expected behaviour
            	ensure that {
                	when {                      	     
                    	the IUT entity receives an r_488_NotAcceptableHere containing
                        From indicating value PX_UE_A_SIP_URI,
                        To indicating value PX_UE_B_SIP_URI,
                        CallId indicating value PX_UE_A_CALLID,
                        Via indicating value PX_UE_A_VIA,
                        Route indicating value PX_UE_A_SERVICE_ROUTE;
                    from the IMS_S_CSCF entity
                }                    	             	
              	then {
                    	the IUT entity sends an REFER containing
                        From indicating value PX_UE_A_SIP_URI,
                        To indicating value PX_UE_B_SIP_URI,
                        CallId indicating value PX_UE_A_CALLID,
                        Via indicating value PX_UE_A_VIA,
                        Route indicating value PX_UE_A_SERVICE_ROUTE,
                        ReferSub indicating value false,  			// 1. the Refer-Sub header field with value "false"
                        Require indicating value "norefersub",	// 2. the Require header field with value "norefersub"
                        ReferTo containing "a SIP URI with the Target-Dialog_URI_header_field"  // 3. the Refer-To header field containing the additional transferred session SCC AS URI for PS to CS dual radio, where the URI also includes the following header fields containing the information related to the additional transferred session:
                        	TargetDialog indicating value "TODO: dialog identifier of an dialog in the early phase supporting session of the SC UE", // A. the Target-Dialog header field populated, containing the dialog identifier of an dialog in the early phase supporting session of the SC UE;
                        	Require indicating value "tdialog", // B. the Require header field populated with the option tag value "tdialog"
                        	To indicating value "", // C. the To header field populated, containing the value of the P-Asserted-Identity provided by the remote UE during the session establishment;
                        	From indicating value "", // D. the From header field populated, containing the value of the P-Asserted-Identity provided by the SC UE during the session establishment;
                        	ContentType indicating value "application/sdp", // E. the Content-Type header field with "application/sdp";
                        	MessageBody containing  // F. the URI header field with the hname "body" populated with SDP describing the media streams as negotiated in the session with the remote UE
                            	SDP containing
                            		TODO indicating value "";
                        		;
                        	;,
                        	PAssertedIdentity indicating value ""; // G. optionally the P-Asserted-Identity URI header field containing value of the P-Asserted-Identity header field of the received SIP INVITE request
                        		
                    to the IMS_S_CSCF entity
                    }
                }
            	
            } // end TP_ICS_SCCAS_PCT_REF_02
            
            
             Test Purpose {
            	
			// When the SCC AS receives a SIP 1xx response with an SDP answer the SCC AS shall:
			//		a) send a SIP PRACK request towards the CS domain; and
			//		b) send an SIP UPDATE request to the remote UE populated as follows:
			//			- the Request-URI set to the URI contained in the Contact header field returned at the creation of the dialog
			//			with the remote UE;
			//			- the Contact header field set to the Contact header field provided by the served UE at the creation of the
			//			dialog with the remote UE; and
			//			- anew SDP offer, including the media characteristics as received in the SIP 1xx response with the SDP
			//			answer, by following the rules of 3GPP TS 24.229 [2].
            	
            	TP Id TP_ICS_SCCAS_PCT_XXX_02 
            	
            	Test objective "Verify that the SCC AS sends a SIP PRACK and SIP UPDATE after receiving a SIP 1xx"                     	
    		
	    		Reference 
	            "ETSI TS 124 237 [1], Clauses 9.3.5.5" 
	        
	        	Config Id CFG_SCCAS_01
	        
	       	 	PICS Selection NONE  // TODO
	        
	        	Initial conditions with {
	            	the UE entity isRegisteredTo the IMS 
					// TODO: 
					// SIP INVITE was sent with:
						//  creating the session in the terminating alerting phase without an SDP MIME body
					// SCC AS supports PS to CS dual radio access
	        	}
	        	
	        	Expected behaviour
            	ensure that {
                	when {                      	     
                    	the IUT entity receives an r_1xx_Any containing
                        From indicating value PX_UE_A_SIP_URI,
                        To indicating value PX_UE_B_SIP_URI,
                        CallId indicating value PX_UE_A_CALLID,
                        Via indicating value PX_UE_A_VIA,
                        Route indicating value PX_UE_A_SERVICE_ROUTE;
                    from the IMS_S_CSCF entity
                }                    	             	
              	then {
                    	the IUT entity sends an PRACK containing // send a SIP PRACK request towards the CS domain
                        From indicating value PX_UE_A_SIP_URI,
                        To indicating value PX_UE_B_SIP_URI,
                        CallId indicating value PX_UE_A_CALLID,
                        Via indicating value PX_UE_A_VIA,
                        Route indicating value PX_UE_A_SERVICE_ROUTE;
                        and 
                        the IUT entity sends an UPDATE containing
                        From indicating value PX_UE_A_SIP_URI,
                        To indicating value PX_UE_B_SIP_URI,
                        CallId indicating value PX_UE_A_CALLID,
                        Via indicating value PX_UE_A_VIA,
                        Route indicating value PX_UE_A_SERVICE_ROUTE,
                        Contact indicating value "set to the Contact header field provided by the served UE at the creation of the dialog with the remote UE", // the Contact header field set to the Contact header field provided by the served UE at the creation of the dialog with the remote UE;
                        MessageBody containing  // anew SDP offer, including the media characteristics as received in the SIP 1xx response with the SDP answer, by following the rules of 3GPP TS 24.229 [2].
                            	SDP containing
                            		Media indicating value "the same media characteristics as received in the SIP 1xx response with the SDP answer";
                            		;
                        ;		
                    to the IMS_S_CSCF entity
                    }
                }
            	
            	
            } // end TP_ICS_SCCAS_PCT_XXX_02
			
			
		} // end Group "9.3.5.5 SCC AS procedures for PS to CS dual radio access transfer of a terminating session in the alerting phase"
    	
    } // end Group "9.3.5 9.3.5 SCC AS procedures for PS to CS dual radio access transfer of calls in an early dialog phase"
    
    Group "9.3.6 Removal of non-transferred audio media components and release of source access legs"
    {
    	import all from Sip_Common;
    	
    	 
            Test Purpose {
            	
            	
            TP Id TP_ICS_SCCAS_XXX_BYE_01  
            
            // When the transfer of a session is successfully completed, then the SCC AS shall release the source legs as follows:
            // 1) the source access leg is an ongoing session containing only an active or inactive media component or a session in
			// an early dialog phase on the terminating side, send a SIP BYE request on the source access leg in accordance
			// with 3GPP TS 24.229 [2];
        
        	Test objective "Verify that the SCC AS sends a SIP BYE after transfer of a session is successfully completed and the source access leg is an ongoing session containing only an active or inactive media component"
       
        
        	Reference 
            "ETSI TS 124 237 [1], Clauses 9.3.6." 
        
        	Config Id CFG_SCCAS_01
        
       	 	PICS Selection NONE  // TODO
        
        	Initial conditions with {
            	the UE entity isRegisteredTo the IMS 
            	// TODO
            	// source access leg is an ongoing session containing only an active or inactive media component
				
        	}
        	
        	Expected behaviour
            	ensure that {
                	when {                 
                    	the IUT entity receives an ACK 
                    	// TODO: trigger for event unclear, transfer of a session is successfully completed
                    from the IMS_S_CSCF entity
                }                    	             	
              	then {
                    	the IUT entity sends an BYE containing
                        From indicating value PX_UE_A_SIP_URI,
                        To indicating value PX_UE_B_SIP_URI,
                        CallId indicating value PX_UE_A_CALLID,
                        Via indicating value PX_UE_A_VIA;
                        
                    to the IMS_S_CSCF entity
                    }
                }
            	
            
            } // end TP_ICS_SCCAS_XXX_BYE_01 
            
            
            
            Test Purpose {
            	
            	
            TP Id TP_ICS_SCCAS_XXX_YYY_02  
            
            // When the transfer of a session is successfully completed, then the SCC AS shall release the source legs as follows:
            // 2) the session is dialog in an early dialog phase on the originating side send a SIP 480 (Temporary Unavailable)
			// response on the source access leg in accordance with 3GPP TS 24.229 [2];
        
        	Test objective  "Verify that the SCC AS sends a SIP 480 after transfer of a session is successfully completed and the session is dialog in an early dialog phase on the originating side"
        
        
        	Reference 
            "ETSI TS 124 237 [1], Clauses 9.3.6." 
        
        	Config Id CFG_SCCAS_01
        
       	 	PICS Selection NONE  // TODO
        
        	Initial conditions with {
            	the UE entity isRegisteredTo the IMS 
            	// TODO: session is dialog in an early dialog phase on the originating side
        	}
        	
        	Expected behaviour
            	ensure that {
                	when {                 
                    	the IUT entity receives an ACK 
                    	
                    	// TODO: trigger for event unclear, transfer of a session is successfully completed
                    	
                    from the IMS_S_CSCF entity
                }                    	             	
              	then {
                    	the IUT entity sends an r_480_TemporaryUnavailable containing
                        From indicating value PX_UE_A_SIP_URI,
                        To indicating value PX_UE_B_SIP_URI,
                        CallId indicating value PX_UE_A_CALLID,
                        Via indicating value PX_UE_A_VIA,
                        Route indicating value PX_UE_A_SERVICE_ROUTE;
                    to the IMS_S_CSCF entity
                    }
                }
            	
            
            } // end TP_ICS_SCCAS_XXX_YYY_02
            
            
            
            Test Purpose {
            	
            	
            TP Id TP_ICS_SCCAS_MED_RIN_01  
            
            // When the transfer of a session is successfully completed, then the SCC AS shall release the source legs as follows:
            // 3) the source access leg contains media components other than speech media component, the SCC AS should send
			// a SIP re-INVITE request to update the source access leg in accordance with 3GPP TS 24.229 [2]
        
        	Test objective  "Verify that SCC AS sends a reINVITE after transfer of a session is successfully completed and the source access leg contains media components other than speech media component"
        
        	Reference 
            "ETSI TS 124 237 [1], Clauses 9.3.6." 
        
        	Config Id CFG_SCCAS_01
        
       	 	PICS Selection NONE  // TODO
        
        	Initial conditions with {
            	the UE entity isRegisteredTo the IMS 
            	// TODO:
            	// transfer of a session is successfully completed
            	// and
            	// the source access leg contains media components other than speech media component
        	}
        	
        	Expected behaviour
            	ensure that {
                	when {                 
                    	the IUT entity receives an ACK 
                    	
                        // TODO: trigger for event unclear, transfer of a session is successfully completed
                        
                    from the IMS_S_CSCF entity
                }                    	             	
              	then {
                    	the IUT entity sends an INVITE containing // reINVITE
                        From indicating value PX_UE_A_SIP_URI,
                        To indicating value PX_UE_B_SIP_URI,
                        CallId indicating value PX_UE_A_CALLID,
                        Via indicating value PX_UE_A_VIA,
                        Route indicating value PX_UE_A_SERVICE_ROUTE,
                        ContentType indicating value "application/sdp",
                        ContentLength,
                        MessageBody containing
                            SDP containing
                                Media indicating value "TODO: the source access leg contains media components other than speech media component";;;
                    to the IMS_S_CSCF entity
                    }
                }
            	
            
            } // end TP_ICS_SCCAS_MED_RIN_01
            
    } // end Group "9.3.6 Removal of non-transferred audio media components and release of source access legs"
    
} // End of Package TP_SCCAS

